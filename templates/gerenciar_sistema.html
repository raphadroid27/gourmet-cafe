{% extends "base.html" %}

{% block title %}Gerenciar Sistema{% endblock %}

{% block content %}
<h1 class="mb-4 mt-4">Gerenciar Sistema</h1>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="alert alert-info">
    {% for message in messages %}
      {{ message }}
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Seção de Feedbacks -->
<h2 class="mb-4 mt-4">Feedbacks</h2>
<form method="GET" action="{{ url_for('gerenciar_sistema') }}">
    <div class="input-group mb-3">
        <input type="text" class="form-control" name="search_feedback" placeholder="Buscar feedbacks" value="{{ request.args.get('search_feedback', '') }}">
        <div class="input-group-append">
            <button class="btn btn-primary" type="submit">Buscar</button>
        </div>
    </div>
</form>
<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Comentário</th>
                <th>Respondido</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for feedback in feedbacks %}
            <tr>
                <td>{{ feedback.nome }}</td>
                <td>{{ feedback.email }}</td>
                <td>{{ feedback.sugestao }}</td>
                <td class="text-center">{{ 'Sim' if feedback.respondido else 'Não' }}</td>
                <td class="text-center">
                    <form action="{{ url_for('gerenciar_sistema') }}" method="post" style="display:inline;">
                        <input type="hidden" name="feedback_id" value="{{ feedback.id }}">
                        <button type="submit" class="btn {{ 'btn-danger' if feedback.respondido else 'btn-success' }} w-100">
                            {{ 'Marcar como não respondido' if feedback.respondido else 'Marcar como respondido' }}
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Seção de Produtos -->
<h2 class="mb-4 mt-4">Listar Produtos</h2>
<form method="GET" action="{{ url_for('gerenciar_sistema') }}">
    <div class="input-group mb-3">
        <input type="text" class="form-control" name="search_produto" placeholder="Buscar produtos" value="{{ request.args.get('search_produto', '') }}">
        <div class="input-group-append">
            <button class="btn btn-primary" type="submit">Buscar</button>
        </div>
    </div>
</form>
<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Descrição</th>
                <th>Preço</th>
                <th>Tipo</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr>
                <td>{{ produto.nome }}</td>
                <td>{{ produto.descricao }}</td>
                <td>{{ produto.preco }}</td>
                <td>{{ produto.tipo }}</td>
                <td class="text-center">

                    <a href="{{ url_for('editar_produto', produto_id=produto.id) }}" class="btn btn-primary w-100%">Editar</a>
                    <form action="{{ url_for('excluir_produto', produto_id=produto.id) }}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger w-100%">Excluir</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-3">
    <a href="{{ url_for('cadastrar_produto') }}" class="btn btn-success">Cadastrar Novo Produto</a>
</div>

<!-- Seção de Usuários -->
<h2 class="mt-4 mb-4">Listar Usuários</h2>
<form method="GET" action="{{ url_for('gerenciar_sistema') }}">
    <div class="input-group mb-3">
        <input type="text" class="form-control" name="search_usuario" placeholder="Buscar usuários" value="{{ request.args.get('search_usuario', '') }}">
        <div class="input-group-append">
            <button class="btn btn-primary" type="submit">Buscar</button>
        </div>
    </div>
</form>
<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Data de Nascimento</th>
                <th>Endereço de Entrega</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr>
                <td>{{ usuario.nome }}</td>
                <td>{{ usuario.email }}</td>
                <td>{{ usuario.data_nascimento }}</td>
                <td>{{ usuario.endereco_entrega }}</td>
                <td class="text-center">
                    <form action="{{ url_for('excluir_usuario') }}" method="post" style="display:inline;">
                        <input type="hidden" name="email" value="{{ usuario.email }}">
                        <button type="submit" class="btn btn-danger w-100">Excluir</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}