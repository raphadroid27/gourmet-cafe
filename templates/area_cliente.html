{% extends "base.html" %}

{% block title %}Área do Cliente{% endblock %}
{% block content %}
<div class="centered-form">
<h2>Informações do Usuário</h2>
<p>Nome: {{ usuario.nome }}</p>
<p>Email: {{ usuario.email }}</p>
<p>Data de Nascimento: {{ usuario.data_nascimento.strftime('%d/%m/%Y') if usuario.data_nascimento else 'N/A' }}</p>
<p>Endereço de Entrega: {{ usuario.endereco_entrega }}</p>
<a href="{{ url_for('editar_usuario') }}" class="btn btn-primary">Editar Informações</a>

<h2>Pedidos</h2>
<div class="table-responsive">
<table class="table">
    <thead>
        <tr>
            <th>Código do Pedido</th>
            <th>Data</th>
            <th>Total</th>
            <th>Quantidade de Itens</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}
        <tr>
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.data_compra.strftime('%d/%m/%Y') }}</td>
            <td>R$ {{ '%.2f'|format(pedido.preco_total) }}</td>
            <td>{{ pedido.quantidade }}</td>
            <td>
                <a href="{{ url_for('detalhes_pedido', pedido_id=pedido.id) }}" class="btn btn-secondary">Ver Detalhes</a>
                {% if pedido.data_compra.strftime('%d/%m/%Y') == current_date %}
                <a href="{{ url_for('devolucao', pedido_id=pedido.id) }}" class="btn btn-danger">Solicitar Devolução</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
<h2>Avaliações</h2>
<div class="table-responsive">
<table class="table">
    <thead>
        <tr>
            <th>Produto</th>
            <th>Nota</th>
            <th>Comentário</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for avaliacao in avaliacoes %}
        <tr>
            <td>{{ avaliacao.produto.nome }}</td>
            <td>
                {% for i in range(1, 6) %}
                    <i class="fas fa-star{% if i > avaliacao.nota %}-o{% endif %}"></i>
                {% endfor %}
            </td>
            <td>{{ avaliacao.comentario }}</td>
            <td>
                <a href="{{ url_for('editar_avaliacao', avaliacao_id=avaliacao.id) }}" class="btn btn-primary">Editar</a>
                <form action="{{ url_for('excluir_avaliacao', avaliacao_id=avaliacao.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger">Excluir</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
</div>

{% endblock %}
